import{_ as $,m as x,n as L,k as f,d as l,w as e,b as n,o as a,e as r,j as d,f as u,t as i,i as A,l as B,F as N,h as b}from"./index-1da159f2.js";const F=x({name:"UserListings",data(){return{userCars:[],loading:!1,error:null}},computed:{...L("auth",["user","token"])},async created(){!this.user&&localStorage.getItem("token")&&await this.$store.dispatch("auth/initAuth"),await this.fetchUserCars()},methods:{async fetchUserCars(){if(!this.token){this.error="Please log in to view your listings";return}try{this.loading=!0,this.error=null;const s=await f.get("/api/cars",{headers:{Authorization:`Bearer ${this.token}`}});console.log("Current user:",this.user),console.log("All cars:",s.data),this.userCars=s.data.filter(t=>(console.log("Comparing car.userId:",t.userId,"with user.id:",this.user.id),t.userId===this.user.id)),console.log("Filtered user cars:",this.userCars)}catch(s){console.error("Error fetching user cars:",s),this.error="Failed to load your listings"}finally{this.loading=!1}},async deleteListing(s){if(confirm("Are you sure you want to delete this listing?"))try{await f.delete(`/api/cars/${s}`,{headers:{Authorization:`Bearer ${this.token}`}}),await this.fetchUserCars()}catch(t){console.error("Error deleting car:",t)}}}}),I={class:"text-truncate"};function U(s,t,V,E,S,Y){const m=n("v-btn"),c=n("v-col"),_=n("v-row"),g=n("v-progress-circular"),p=n("v-alert"),v=n("v-img"),h=n("v-card-title"),y=n("v-card-text"),k=n("v-card-actions"),C=n("v-card"),w=n("v-container");return a(),l(w,null,{default:e(()=>[r(_,null,{default:e(()=>[r(c,{cols:"12"},{default:e(()=>[t[1]||(t[1]=d("h2",{class:"text-h4 mb-4"},"My Listings",-1)),r(m,{color:"primary",to:"/cars/new",class:"mb-4"},{default:e(()=>t[0]||(t[0]=[u(" Add New Listing ")])),_:1})]),_:1})]),_:1}),s.loading?(a(),l(_,{key:0},{default:e(()=>[r(c,{cols:"12",class:"text-center"},{default:e(()=>[r(g,{indeterminate:""})]),_:1})]),_:1})):s.error?(a(),l(_,{key:1},{default:e(()=>[r(c,{cols:"12"},{default:e(()=>[r(p,{type:"error"},{default:e(()=>[u(i(s.error),1)]),_:1})]),_:1})]),_:1})):s.userCars.length?(a(),l(_,{key:3},{default:e(()=>[(a(!0),A(N,null,B(s.userCars,o=>(a(),l(c,{key:o._id,cols:"12",sm:"6",md:"4"},{default:e(()=>[r(C,null,{default:e(()=>[o.images&&o.images.length?(a(),l(v,{key:0,src:o.images[0],height:"200",cover:""},null,8,["src"])):b("",!0),r(h,null,{default:e(()=>[u(i(o.make)+" "+i(o.model),1)]),_:2},1024),r(y,null,{default:e(()=>[d("div",null,"Year: "+i(o.year),1),d("div",null,"Price: $"+i(o.price),1),d("div",null,"VIN: "+i(o.vinCode),1),d("div",null,"Mileage: "+i(o.mileage)+" km",1),d("div",I,i(o.description),1)]),_:2},1024),r(k,null,{default:e(()=>[r(m,{color:"error",variant:"text",onClick:z=>s.deleteListing(o._id)},{default:e(()=>t[4]||(t[4]=[u(" Delete ")])),_:2},1032,["onClick"]),r(m,{color:"primary",variant:"text",to:`/cars/edit/${o._id}`},{default:e(()=>t[5]||(t[5]=[u(" Edit ")])),_:2},1032,["to"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(a(),l(_,{key:2},{default:e(()=>[r(c,{cols:"12",class:"text-center"},{default:e(()=>[t[3]||(t[3]=d("p",null,"You haven't created any listings yet.",-1)),r(m,{color:"primary",to:"/cars/new"},{default:e(()=>t[2]||(t[2]=[u(" Create Your First Listing ")])),_:1})]),_:1})]),_:1}))]),_:1})}const M=$(F,[["render",U]]);export{M as default};
